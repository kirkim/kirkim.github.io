---
layout: post
title:  "[ft_printf](11)ft_print테스트"
subtitle:   ""
date: 2021-04-01 02:45:51 +0900
categories: 42seoul
tags: ft_printf
comments: true 
---

이번 포스트는 <b>ft_print테스트</b>에 관한 내용입니다.

<br /><br />

* * *
<h2>1️⃣ 테스트진행(42TESTERS - PRINTF프로그램 이용)</h2>

* ft_printf과제의 <b>테스터 프로그램</b>이 여러가지가 있지만 그 중에서 `42TESTERS-PRINTF`테스터 프로그램을 이용하여 테스트를 진행했습니다.

<b><span style="color:#084B8A;">테스터 프로그램 링크 &gt;&gt; </span><a href="https://github.com/Mazoise/42TESTERS-PRINTF" target="blank">Mazoise - 42TESTERS-PRINTF</a></b><br />
<h3 align="middle" style="color:#0e435c;">&lt; 현재 나의 ft_printf 테스트 결과 &gt;</h3>
<img src="https://kirkim.github.io/assets/img/c/printf_test1.png" alt="42TESTERS_result_image.png" width="100%">

* **틀린 케이스**결과는 `diff.txt`파일에서 자세히 확인할 수 있습니다.
<h3 align="middle" style="color:#0e435c;">&lt; diff.txt &gt;</h3>
<img src="https://kirkim.github.io/assets/img/c/printf_test2.png" alt="42TESTERS_diff_file_image.png" width="100%">
<br /><br />

* * *
<h2>2️⃣ 케이스1</h2>
<h3 style="color:#0e435c;">(1) `%0.` + `d`, `i`, `u`, `x`, `X`, `o`출력값 오류</h3>
<kkr>
<b style="color:#999988; font-style: italic;">----------12번 테스트 케이스----------</b><br />
%0.d, %0.d, %0.d, <b style="color:#dd1144;">%0.d</b>, %0.d" // 1st '*' = -4, 2nd '*' = 0<br />
<br />
<b style="color:#999988; font-style: italic;">/* 나의 출력 */</b><br />
8, -12, 123456789, <b style="color:#dd1144;">0</b>, -12345678, 97, -2147483648, 2147483647 --- Return : 60<br />
<b style="color:#999988; font-style: italic;">/* 올바른 출력 */</b><br />
8, -12, 123456789, , -12345678, 97, -2147483648, 2147483647 --- Return : 59<br />
</kkr>

* `printf("%0.d", 0);`의 케이스가 올바르지 않았습니다.
* `%0.d`일 때 **1, 2, ,3 ,4 ...**등은 그대로 출력되지만 <b style="color:#dd1144;">0</b>일 경우 <b style="color:#dd1144;">공백</b>을 출력해줘야 됩니다.
<img src="https://kirkim.github.io/assets/img/c/printf_test3.png" alt="result_ubuntu_image.png" width="100%">

* **Ubuntu Vscode(wsl)**에서는 위처럼 `%0.d`처럼 서식자를 사용하는 것에 대해 **오류를 출력**해 주었기 때문에 따로 예외처리없이 코드를 구현했습니다.
* 하지만 **42Seoul**의 과제는 **MacOs**운영체제를 기준으로 하는 과제이기 때문에 그 규칙을 따라야 합니다.
<h3 style="color:#0e435c;">(2) 해결법</h3>

* 정수값의 숫자부분 문자열을 만들어주는 함수인 `set_print_cpy`안에서 `ft_ullitoa_cpy`을 사용한 직후에 다음과 같은 예외처리 코드를 추가해줬습니다.

```c
if (fg->point == 1 && fg->padding_back == 0 && fg->result[0] == '0' && fg->result[1] == '\0')
    fg->result[0] = '\0';
```

<br /><br />

* * *
<h2>2️⃣ 케이스2</h2>
<h3 style="color:#0e435c;">(1) 숫자 정밀도가 음수일 때(`.-n`) 출력값 오류</h3>
<kkr>
<b style="color:#999988; font-style: italic;">----------37번 테스트 케이스----------</b><br />
"%.*i, %.*d, %.*d, %.*d, %.*d, %.*d, %.*d, %.*d" // 1st '*' = -4, 2nd '*' = 0<br />
<br />
<b style="color:#999988; font-style: italic;">/* 나의 출력 */</b><br />
0008, -0012, 123456789, 0000, -12345678, 0097, -2147483648, 2147483647 --- Return : 70<br />
<b style="color:#999988; font-style: italic;">/* 올바른 출력 */</b><br />
8, -12, 123456789, 0, -12345678, 97, -2147483648, 2147483647 --- Return : 60<br />
</kkr>

* `.*`를 이용하여 음수를 받아올 때 **양수부분**의 값만큼 **정밀도옵션**을 적용해주어 `0`을 출력해준 것이 문제였습니다.
* 역시 **wsl**환경에서는 적절한 사용의 방법이 아니라고 경고메시지를 출력해주었습니다.
* 하지만 역시나 **macOs**환경에 맞추어 예외처리코드를 구현해 주어야 합니다.
<img src="https://kirkim.github.io/assets/img/c/printf_test4.png" alt="result_ubuntu_image.png" width="100%">

* 위의 경우처럼 `.*`을 이용하는 것이 아닌 `.-2d`와 같이 직접적으로 **음수값**을 정밀도 옵션에 넣을 때는 **macOs**환경에서도 경고 메시지를 출력해 주었습니다.
<h3 style="color:#0e435c;">(2) 해결법</h3>

* 기존에 코드를 짤 때 **정밀도옵션**에 음수가 들어오지 않는다는 가정으로 구현했습니다.
* 그래서 **정밀도옵션**을 읽어드리는 코드가 **음수**도 읽어드릴 수 있도록 바꿨습니다.

```c
else if (fg->point == 1)  // 포인트(.)뒤를 읽을 때
{
	if (**format == '-')
		fg->back_minus = 1;  // back_minus은 새로운 구조체변수로 선언
	else
		fg->padding_back = 10 * fg->padding_back + (**format - '0');
}

/* 모든옵션을 읽어드린 후 */
if (fg->back_minus == 1)  // back_minus가 1이라면
	fg->padding_back *= -1;  // 정밀도 저장값을 음수로 만듬
```
<h3 style="color:#0e435c;">(3) 또다른 오류</h3>
<kkr>
<b style="color:#999988; font-style: italic;">----------37번 테스트 케이스----------</b><br />
"%.*i, %.*d, %.*d, <b style="color:#dd1144;">%.*d<b style="color:#dd1144;">, %.*d, %.*d, %.*d, %.*d" // 1st '*' = -4, 2nd '*' = 0<br />
<br />
<b style="color:#999988; font-style: italic;">/* 나의 출력 */</b><br />
8, -12, 123456789, , -12345678, 97, -2147483648, 2147483647 --- Return : 59<br />
<b style="color:#999988; font-style: italic;">/* 올바른 출력 */</b><br />
8, -12, 123456789, <b style="color:#dd1144;">0</b>, -12345678, 97, -2147483648, 2147483647 --- Return : 60<br />
</kkr>

* **37번**테스트의 케이스 대부분이 통과하였습니다. 하지만 `printf("%.*d", -4, 0);`의 케이스에서 오류가 났습니다.
* `printf("%.*d", -4, 0);`는 `0`이 출력되야 합니다.
* 반면 같은 코드라고 볼 수 있는 `printf("%.-4d", 0);`는 ``(공백)이 출력되야 합니다.
* 규칙이라고 하기에는 약간 애매(?)한 부분이 있지만 이와 같이 출력이 되도록 다시 구현해야 됩니다.

```c
/* set_flag함수 내부 수정 */
fg->back_star = 1; // '.*'옵션을 발견하면 1값을 갖는 변수로 선언

/* 0문자열을 공백으로 바꾸는 조건문 */
if (fg->back_star == 0 && fg->point == 1 && fg->padding_back == 0 && fg->result[0] == '0' && fg->result[1] == '\0')
        fg->result[0] = '\0';
```

* 위와 같이 코드를 추가, 수정해 주었습니다.
* **'0문자열을 공백으로 바꾸는 조건문'**은 **'케이스1'**의 해결법으로 구현했던 코드에 `fg->back_star == 0`조건을 추가한 코드입니다.


